
@{
    ViewBag.Title = "ReportData";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-lg-12 mb-3">
        <h4>@ViewBag.Title</h4>
    </div>
    <div class="col-lg-12" id="date_div">
        <div class="card">
            <div class="card-body d-flex flex-column justify-content-between">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="col-lg-12">
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control date" placeholder="Select Date" id="start_date">
                                        <div class="input-group-append">
                                            <button class="btn btn-sm btn-facebook" type="button">
                                                <i class="fi fi-rr-daily-calendar"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control date" placeholder="Select Date" id="end_date">
                                        <div class="input-group-append">
                                            <button class="btn btn-sm btn-facebook" type="button">
                                                <i class="fi fi-rr-daily-calendar"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div align="center" class="col-lg-12 mt-3">
                                    <button class="btn btn-xs btn-danger" id="sbmit_btn" style="text-align:center; width:150px; font-size:13px;" onclick="showReport()"><i class="fi fi-rr-disk" style="font-size:12px;"></i>&nbsp;Show</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-12" id="report_div" style="display:none;">
        <div class="card">
            <div class="card-body d-flex flex-column justify-content-between">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div class="col-lg-12">
                        <div class="row" id="ReportViewer">
                            <div class="col-lg-12 mb-3">
                                <button class="btn btn-xs btn-danger" id="back_btn" style="text-align:center; width:150px; font-size:13px;" onclick="back()">&nbsp;Back</button>
                            </div>
                            <div class="col-lg-12 table-responsive">
                                <iframe id="ReportFrame" src="" style="border:none; width: 100%; height:1000px;"></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
    $(document).ready(function () {

        $('.date').datepicker({
            format: 'mm/dd/yyyy',
            autoclose: true,
            todayHighlight: true
        });
        DefaultDate();

    });

    function DefaultDate() {

        let startDateInput = $('#start_date');
        let endDateInput = $('#end_date');

        var date = new Date();
        date.setDate(date.getDate() - 7);
        var fyear = date.getFullYear();
        var fmonth = date.getMonth();
        var fday = date.getDate();

        var sFrmDate = (fmonth + 1) + "/" + fday + "/" + fyear;

        startDateInput.val(sFrmDate);
        date = new Date();
        date.setDate(date.getDate());
        fyear = date.getFullYear();
        fmonth = date.getMonth();
        fday = date.getDate();

        var vFrmDate = (fmonth + 1) + "/" + fday + "/" + fyear;
        endDateInput.val(vFrmDate);

        startDateInput.datepicker({
            autoclose: true,
            todayHighlight: true

        });
        endDateInput.datepicker({
            autoclose: true,
            todayHighlight: true
        });
        startDateInput.on('changeDate', function (e) {
            let sFrmDate = new Date(e.date);
            endDateInput.datepicker('setStartDate', sFrmDate);
        });

    }

    async function showReport() {
        let st_date = $("#start_date").val();
        let end_date = $("#end_date").val();
        
        try {
            const response = await $.ajax({
                type: "POST",
                url: "/Report/GET_REPORT_DATA",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify({
                    ST_DATE: st_date,
                    END_DATE: end_date
                })
            });

            if (response.has_data) {
                $("#date_div").hide();
                $("#report_div").show();
                var ur = '../../Report/RPTViewer.aspx';
                $("#ReportFrame").attr("src", ur);
                //$("#ReportViewer").show();
            } else {
                showMessage("report genarate failed", "error");
                back();
            }
        } catch (error) {
            console.error("Error fetching GET_REPORT_DATA:", error);
            showMessage("An error occurred while fetching GET_REPORT_DATA.", "error");
        }
    }

    function back() {
        $("#date_div").show();
        $("#report_div").hide();
    }
</script>